# frozen_string_literal: true

require "test_helper"

module Asciidoctor
  module Html
    # Tests the html generated by the converter is correct
    class TestConverter < Minitest::Test
      def setup
        @converter = Asciidoctor::Converter.create "html5"
      end

      def check_adoc_matches_html(dirpath)
        context = dirpath.basename.to_s
        dirpath.children.each do |filepath|
          next unless filepath.extname == ".adoc"

          doc = Asciidoctor.load_file filepath
          html = File.read(filepath.sub_ext(".html"))
          node = doc.find_by(context: context.to_sym).first

          assert_equal @converter.public_send("convert_#{context}", node), html
        end
      end

      def test_converted_adoc_matches_html
        Pathname(__dir__).children.each do |pn|
          next unless pn.directory?

          check_adoc_matches_html pn
        end
      end
    end
  end
end
